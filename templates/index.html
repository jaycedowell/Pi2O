<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN">
<html>
<head>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="/css/jquery.mobile-1.4.3.min.css">
	<link href="/css/images/favicon.ico" rel="shortcut icon" type="image/x-icon" />
	<script src="/js/jquery-1.11.1.min.js"></script>
	<script src="/js/jquery.mobile-1.4.3.min.js"></script>
	<script type="text/javascript">
		function updateClock(refTime) { 
			// get local time
			var lt = new Date( refTime*1000 + {{ kwds.get('tzOffset') }}*1000 );
			var year = lt.getUTCFullYear();
			var month = lt.getUTCMonth() + 1;
			var day = lt.getUTCDate();
			var hours = lt.getUTCHours();
			var minutes = lt.getUTCMinutes();
			var seconds = lt.getUTCSeconds();
			if (day < 10) {
				day = "0" + day;
			}
			if (month < 10) {
				month = "0" + month;
			}
			if (hours < 10) {
				hours = "0" + hours;
			}
			if (hours > 12) {
				hours = hours - 12;
				ampm = "PM";
			} else {
				ampm = "AM";
			}
			if (minutes < 10) {
				minutes = "0" + minutes;
			}
			if (seconds < 10) {
				seconds = "0" + seconds;
			}
			var lts = year + "/" + month + "/" + day;
			lts = lts + " " + hours + ":" + minutes + ":" + seconds + " " + ampm;

			// update text fields
			var span = document.getElementById('ltClock');
			span.innerHTML = lts;
			
			refTime += 1.0;
			setTimeout("updateClock("+refTime.toFixed(2)+")", 1000); 
		}
	</script>
</head>
<body onload="updateClock({{ kwds.get("tNow").strftime("%s.%f") }});">
	<div data-role="page">
	<div data-role="header" role="banner" class="ui-header ui-bar-inherit">
		<h1 class="ui-title" role="heading" aira-level="1">Pi<sub>2</sub>O</h1>
	</div>
	<div data-role="main" class="ui-content">
		<div class="ui-field-contain">
			<h3 class="ui-title" role="heading" aira-level="1">Local Time</h3>
			<span id="ltClock" class="clock"></span><br />
		</div>
		{% for zone in range(1,5) %}
		{% if kwds.get("zone%i-enabled"|format(zone)) == 'on' %}
		<div class="ui-field-contain">
			<h3 class="ui-title" role="heading" aira-level="1">Zone {{ zone }}</h3>
			{% if kwds.get("zone%i-status"|format(zone)) == 'on' %}
			{{ kwds.get("zone%i-name"|format(zone)) }} is on
			{% else %}
			{% set rtime = kwds.get("zone%i-lastStop"|format(zone)) - kwds.get("zone%i-lastStart"|format(zone)) %}
			{% set stime = rtime.days*86400 + rtime.seconds %}
			{{ kwds.get("zone%i-name"|format(zone)) }} last ran on {{ kwds.get("zone%i-lastStart"|format(zone)).strftime("%m/%d/%Y") }} for {{ "%i:%02i:%02i"|format(stime/3600, stime%3600/60, stime%60) }} <i>({{ 'manual' if kwds.get("zone%i-adjust"|format(zone)) < 0 else "weather adjustment %i%%"|format(100.0*kwds.get("zone%i-adjust"|format(zone))) }})</i>
			{% endif %}
		</div>
		{% endif %}
		{% endfor %}
	</div>
	<br />
	<div data-role="footer" role="banner" class="ui-header ui-bar-inherit">
		<div data-role="navbar">
			<ul>
				<!--<li><a href="/">Home</a></li>-->
				<li><a href="/zones">Zones</a></li>
				<li><a href="/schedules">Schedules</a></li>
				<li><a href="/weather">Weather</a></li>
				<li><a href="/manual">Manual Control</a></li>
				<li><a href="/logs">Logs</a></li>
			</ul>
		</div>
	</div>
	</div>
</body>
</html>
