<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN">
<html>
<head>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="/css/jquery.mobile-1.4.3.min.css">
	<script src="/js/jquery-1.11.1.min.js"></script>
	<script src="/js/jquery.mobile-1.4.3.min.js"></script>
</head>
<body>
	<div data-role="page">
	<div data-role="header" role="banner" class="ui-header ui-bar-inherit">
		<h1 class="ui-title" role="heading" aira-level="1">Zones</h1>
	</div>
	<form method="post" action="zones">
		<div data-role="main" class="ui-content">
			{% for zone in range(1,5) %}
			<h3 class="ui-title" role="heading" aira-level="1">Zone {{ zone }}</h3>
			<div class="ui-field-contain">
				<label for="zone{{ zone }}-name">Name:</label>
				<input class="name{{ zone }}" type="text" name="zone{{ zone }}-name" value="{{ kwds.get("zone%i-name"|format(zone)) }}"/>
				<label for="zone{{ zone }}-pin">GPIO Pin:</label>
				<select class="pin{{ zone }}" id="pin{{ zone }}" name="zone{{ zone }}-pin">
					<option value="17" {{ 'selected' if kwds.get("zone%i-pin"|format(zone)) == '17' else '' }}>17</option>
					<option value="18" {{ 'selected' if kwds.get("zone%i-pin"|format(zone)) == '18' else '' }}>18</option>
					<option value="23" {{ 'selected' if kwds.get("zone%i-pin"|format(zone)) == '23' else '' }}>23</option>
					<option value="24" {{ 'selected' if kwds.get("zone%i-pin"|format(zone)) == '24' else '' }}>24</option>
					<option value="25" {{ 'selected' if kwds.get("zone%i-pin"|format(zone)) == '25' else '' }}>25</option>
				</select>
				<label for="zone{{ zone }}-enabled">Enabled:</label>
				<select class="enabled{{ zone }}" name="zone{{ zone }}-enabled" data-role="slider">
					<option value="off">Off</option>
					<option value="on" {{ kwds.get("zone%i-enabled"|format(zone)) }}>On</option>
				</select> 
			</div>
			{% endfor %}
			
			<h3 class="ui-title" role="heading" aira-level="1">Rain Sensor</h3>
			<div class="ui-field-contain">
				<fieldset data-role="controlgroup" data-type="horizontal">
					<legend>Type:</legend>
    				<input class="rtype" type="radio" name="rs-type" id="rs-choice-1" value="off" {{ 'checked' if kwds.get('rs-type') == 'off' else '' }}>
    				<label for="rs-choice-1">Not Installed</label>
    				<input class="rtype" type="radio" name="rs-type" id="rs-choice-2" value="software" {{ 'checked' if kwds.get('rs-type') == 'software' else '' }}>
    				<label for="rs-choice-2">Software</label>
    				<input class="rtype" type="radio" name="rs-type" id="rs-choice-3" value="hardware" {{ 'checked' if kwds.get('rs-type') == 'hardware' else '' }}>
    				<label for="rs-choice-3">Hardware</label>
				</fieldset>
				<label for="rs-pin">GPIO Pin:</label>
				<select class="pinr" id="pinr" name="rs-pin">
					<option value="17" {{ 'selected' if kwds.get("rs-pin") == '17' else '' }}>17</option>
					<option value="18" {{ 'selected' if kwds.get("rs-pin") == '18' else '' }}>18</option>
					<option value="23" {{ 'selected' if kwds.get("rs-pin") == '23' else '' }}>23</option>
					<option value="24" {{ 'selected' if kwds.get("rs-pin") == '24' else '' }}>24</option>
					<option value="25" {{ 'selected' if kwds.get("rs-pin") == '25' else '' }}>25</option>
				</select>
				<label for="rs-precip">Rainfall:</label>
				<input class="precip" type="range" name="rs-precip" value="{{ kwds.get("rs-precip") }}" min="0.04" max="0.52" step="0.04" data-highlight="true"/>
			</div>
			
			<script type="text/javascript">
				$(window).load( function() {
				{% for zone in range(1,5) %}
				$('#pin{{ zone }}').selectmenu('refresh', true);
				
				{% if kwds.get("zone%i-enabled"|format(zone)) != 'selected' %}
				$('.name{{ zone }}').textinput('disable');
				$('#pin{{ zone }}').selectmenu('disable');
				{% endif %}
			
				$('.enabled{{ zone }}').trigger('create');
				$('.enabled{{ zone }}').bind('slidestop', function (e) {
					if (this.value == 'on') {
						$('.name{{ zone }}').textinput('enable');
						$('#pin{{ zone }}').selectmenu('enable');
					} else {
						$('.name{{ zone }}').textinput('disable');
						$('#pin{{ zone }}').selectmenu('disable');
					}
				});
				{% endfor %}
				$('#pinr').selectmenu('refresh', true);
				
				{% if kwds.get('rs-type') == 'off' %}
				$('.precip').slider('disable');
				$('#pinr').selectmenu('disable');
				{% endif %}
				{% if kwds.get('rs-type') == 'software' %}
				$('.precip').slider('enable');
				$('#pinr').selectmenu('disable');
				{% endif %}
				{% if kwds.get('rs-type') == 'hardware' %}
				$('.precip').slider('disable');
				$('#pinr').selectmenu('enable');
				{% endif %}
				
				$('.rtype').trigger('create');
				$('.rtype').on('click', function(e) {
					if (this.value == 'off') {
						$('.precip').slider('disable');
						$('#pinr').selectmenu('disable');
					} else {
						if (this.value == 'software') {
							$('.precip').slider('enable');
							$('#pinr').selectmenu('disable');
						} else {
							$('.precip').slider('disable');
							$('#pinr').selectmenu('enable');
						}
					}
				});
			});
			</script>
			
			<button type="submit">Save Configuration</button>
		</div>
	</form>
	<br />
	<div data-role="footer" role="banner" class="ui-header ui-bar-inherit">
		<div data-role="navbar">
			<ul>
				<li><a href="/">Home</a></li>
				<!--<li><a href="/zones">Zones</a></li>-->
				<li><a href="/schedules">Schedules</a></li>
				<li><a href="/weather">Weather</a></li>
				<li><a href="/manual">Manual Control</a></li>
				<li><a href="/logs">Logs</a></li>
			</ul>
		</div>
	</div>
	</div>
</body>
</html>